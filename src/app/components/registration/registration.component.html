<div class="registration-container">
  <div class="registration-card">
    <header class="form-header">
      <button class="back-button" (click)="goBack()">
        <span>‚Üê</span> Voltar
      </button>
      <h1>Inscri√ß√£o - Legacy Camp 2025</h1>
      <p>Preencha seus dados para garantir sua vaga</p>
    </header>

    <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()" class="registration-form">
      
      <!-- üë§ Informa√ß√µes Pessoais -->
      <section class="form-section">
        <h2>üë§ Informa√ß√µes Pessoais</h2>
        
      <div class="form-row">
        <div class="form-group full-width">
            <label for="fullName">Nome completo *</label>
          <input 
            type="text" 
            id="fullName" 
            formControlName="fullName"
            placeholder="Digite seu nome completo"
            [class.error]="submitted && f['fullName'].errors"
          >
          <div class="error-message" *ngIf="submitted && f['fullName'].errors">
            <span *ngIf="f['fullName'].errors['required']">Nome √© obrigat√≥rio</span>
            <span *ngIf="f['fullName'].errors['minlength']">Nome deve ter pelo menos 3 caracteres</span>
          </div>
        </div>
      </div>

      <div class="form-row">
          <div class="form-group">
            <label for="birthDate">Data de nascimento *</label>
            <input 
              type="date" 
              id="birthDate" 
              formControlName="birthDate"
              (change)="calculateAge()"
              [class.error]="submitted && f['birthDate'].errors"
            >
            <div class="error-message" *ngIf="submitted && f['birthDate'].errors">
              <span *ngIf="f['birthDate'].errors['required']">Data de nascimento √© obrigat√≥ria</span>
            </div>
          </div>

          <div class="form-group">
            <label for="age">Idade *</label>
            <input 
              type="number" 
              id="age" 
              formControlName="age"
              readonly
              [class.error]="submitted && f['age'].errors"
            >
            <div class="error-message" *ngIf="submitted && f['age'].errors">
              <span *ngIf="f['age'].errors['required']">Idade √© obrigat√≥ria</span>
              <span *ngIf="f['age'].errors['min']">Idade m√≠nima √© 12 anos</span>
              <span *ngIf="f['age'].errors['max']">Idade m√°xima √© 100 anos</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>G√™nero *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="gender" value="masculino">
                <span class="radio-custom"></span>
                Masculino
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="gender" value="feminino">
                <span class="radio-custom"></span>
                Feminino
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['gender'].errors">
              <span *ngIf="f['gender'].errors['required']">G√™nero √© obrigat√≥rio</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="phone">Telefone (WhatsApp) *</label>
            <input 
              type="tel" 
              id="phone" 
              formControlName="phone"
              placeholder="(11) 99999-9999"
              (input)="formatPhone($event)"
              [class.error]="submitted && f['phone'].errors"
            >
            <div class="error-message" *ngIf="submitted && f['phone'].errors">
              <span *ngIf="f['phone'].errors['required']">Telefone √© obrigat√≥rio</span>
              <span *ngIf="f['phone'].errors['pattern']">Digite um telefone v√°lido</span>
            </div>
          </div>

        <div class="form-group">
          <label for="email">E-mail *</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email"
            placeholder="seu@email.com"
            [class.error]="submitted && f['email'].errors"
          >
          <div class="error-message" *ngIf="submitted && f['email'].errors">
            <span *ngIf="f['email'].errors['required']">E-mail √© obrigat√≥rio</span>
            <span *ngIf="f['email'].errors['email']">Digite um e-mail v√°lido</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="address">Endere√ßo completo *</label>
            <textarea 
              id="address" 
              formControlName="address"
              placeholder="Rua, bairro, cidade, CEP"
              rows="3"
              [class.error]="submitted && f['address'].errors"
            ></textarea>
            <div class="error-message" *ngIf="submitted && f['address'].errors">
              <span *ngIf="f['address'].errors['required']">Endere√ßo √© obrigat√≥rio</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="socialMedia">Rede Social</label>
            <input 
              type="text" 
              id="socialMedia" 
              formControlName="socialMedia"
              placeholder="Instagram e Facebook"
              [class.error]="submitted && f['socialMedia'].errors"
            >
            <div class="error-message" *ngIf="submitted && f['socialMedia'].errors">
              <span *ngIf="f['socialMedia'].errors['required']">Rede social √© obrigat√≥ria</span>
            </div>
          </div>
        </div>

        <!-- Contato de Emerg√™ncia -->
        <div class="form-subsection">
          <h3>Contato de emerg√™ncia</h3>
          <div formGroupName="emergencyContact">
            <div class="form-row">
              <div class="form-group">
                <label for="emergencyName">Nome *</label>
                <input 
                  type="text" 
                  id="emergencyName" 
                  formControlName="name"
                  placeholder="Nome do contato"
                  [class.error]="submitted && emergencyContact.get('name')?.errors"
                >
                <div class="error-message" *ngIf="submitted && emergencyContact.get('name')?.errors">
                  <span *ngIf="emergencyContact.get('name')?.errors?.['required']">Nome √© obrigat√≥rio</span>
          </div>
        </div>

        <div class="form-group">
                <label for="emergencyPhone">Telefone *</label>
          <input 
            type="tel" 
                  id="emergencyPhone" 
            formControlName="phone"
            placeholder="(11) 99999-9999"
                  (input)="formatEmergencyPhone($event)"
                  [class.error]="submitted && emergencyContact.get('phone')?.errors"
                >
                <div class="error-message" *ngIf="submitted && emergencyContact.get('phone')?.errors">
                  <span *ngIf="emergencyContact.get('phone')?.errors?.['required']">Telefone √© obrigat√≥rio</span>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="emergencyRelationship">Grau de parentesco *</label>
                <input 
                  type="text" 
                  id="emergencyRelationship" 
                  formControlName="relationship"
                  placeholder="Ex: Pai, M√£e, Irm√£o, etc."
                  [class.error]="submitted && emergencyContact.get('relationship')?.errors"
                >
                <div class="error-message" *ngIf="submitted && emergencyContact.get('relationship')?.errors">
                  <span *ngIf="emergencyContact.get('relationship')?.errors?.['required']">Grau de parentesco √© obrigat√≥rio</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- üèòÔ∏è Informa√ß√µes de Igreja -->
      <section class="form-section">
        <h2>üèòÔ∏è Informa√ß√µes de Igreja</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label>Voc√™ √© membro de alguma Lagoinha da regi√£o Norte? *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="isLagoinhaMember" value="sim">
                <span class="radio-custom"></span>
                Sim
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="isLagoinhaMember" value="nao">
                <span class="radio-custom"></span>
                N√£o
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['isLagoinhaMember'].errors">
              <span *ngIf="f['isLagoinhaMember'].errors['required']">Esta informa√ß√£o √© obrigat√≥ria</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="churchName">Se sim, qual Lagoinha voc√™ frequenta? (Cidade e nome da igreja) *</label>
            <input 
              type="text" 
              id="churchName" 
              formControlName="churchName"
              placeholder="Ex: Lagoinha Manaus Sede, Lagoinha Manaus Torres, Lagoinha Manaus Japiim, Lagoinha Itacoatiara, etc."
              [class.error]="submitted && f['churchName'].errors"
            >
            <div class="error-message" *ngIf="submitted && f['churchName'].errors">
              <span *ngIf="f['churchName'].errors['required']">Nome da igreja √© obrigat√≥rio</span>
            </div>
            <small class="form-help">‚ùó Caso voc√™ n√£o seja membro de uma Lagoinha, escreva o nome da sua igreja para a an√°lise da sua inscri√ß√£o.</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="ministryParticipation">Voc√™ participa de algum minist√©rio (volunt√°rio ou l√≠der) e algum GC? Quais?</label>
            <textarea 
              id="ministryParticipation" 
              formControlName="ministryParticipation"
              placeholder="Descreva sua participa√ß√£o em minist√©rios e grupos de c√©lulas"
              rows="3"
              [class.error]="submitted && f['ministryParticipation'].errors"
            ></textarea>
            <div class="error-message" *ngIf="submitted && f['ministryParticipation'].errors">
              <span *ngIf="f['ministryParticipation'].errors['required']">Esta informa√ß√£o √© obrigat√≥ria</span>
            </div>
          </div>
        </div>
      </section>

      <!-- üí≥ Informa√ß√µes da Inscri√ß√£o -->
      <section class="form-section">
        <h2>üí≥ Informa√ß√µes da Inscri√ß√£o</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label>Selecione o lote da sua inscri√ß√£o *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="registrationLot" value="lote1">
                <span class="radio-custom"></span>
                1¬∫ Lote ‚Äì R$ 250,00 (100% a vista, e LIMITADO)
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="registrationLot" value="lote2">
                <span class="radio-custom"></span>
                2¬∫ Lote ‚Äì R$ 300,00 (Podendo ser a vista ou parcelado)
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['registrationLot'].errors">
              <span *ngIf="f['registrationLot'].errors['required']">Selecione um lote</span>
            </div>
            <small class="form-help">Ambos os lotes incluem transporte, alimenta√ß√£o e camisa.</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
            <label>Forma de pagamento utilizada *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="paymentMethod" value="pix">
                <span class="radio-custom"></span>
                PIX
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="paymentMethod" value="cartao">
                <span class="radio-custom"></span>
                Cart√£o
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="paymentMethod" value="carne">
                <span class="radio-custom"></span>
                Carn√™ Legacy
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['paymentMethod'].errors">
              <span *ngIf="f['paymentMethod'].errors['required']">Selecione uma forma de pagamento</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="paymentProof">Anexe o comprovante de pagamento</label>
          <input 
              type="file" 
              id="paymentProof" 
              formControlName="paymentProof"
              accept="image/*,.pdf"
            >
            <small class="form-help">Opcional - Upload de imagem ou PDF</small>
          </div>
        </div>

        <!-- Link de Pagamento -->
        <div class="form-row" *ngIf="shouldShowPaymentLink()">
          <div class="form-group full-width">
            <div class="payment-link-container">
              <p class="payment-info">
                <strong>üí≥ Pagamento Online:</strong> Clique no bot√£o abaixo para realizar o pagamento:
              </p>
              <button 
                type="button" 
                class="payment-button"
                (click)="openPaymentLink()"
              >
                üöÄ Pagar com Mercado Pago
              </button>
              <small class="form-help">
                <strong>Valor:</strong> 
                <span *ngIf="f['registrationLot'].value === 'lote1'">R$ 250,00</span>
                <span *ngIf="f['registrationLot'].value === 'lote2'">R$ 300,00</span>
              </small>
            </div>
          </div>
        </div>
      </section>

      <!-- üëï Informa√ß√µes Adicionais -->
      <section class="form-section">
        <h2>üëï Informa√ß√µes Adicionais</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label>Tamanho da sua camisa *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="shirtSize" value="P">
                <span class="radio-custom"></span>
                P
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="shirtSize" value="M">
                <span class="radio-custom"></span>
                M
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="shirtSize" value="G">
                <span class="radio-custom"></span>
                G
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="shirtSize" value="GG">
                <span class="radio-custom"></span>
                GG
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="shirtSize" value="XG">
                <span class="radio-custom"></span>
                XG
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['shirtSize'].errors">
              <span *ngIf="f['shirtSize'].errors['required']">Selecione um tamanho</span>
            </div>
          </div>
        </div>

        <div class="form-row">
        <div class="form-group">
            <label>Possui alguma alergia a alimentos ou medicamentos? *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="hasAllergy" value="sim">
                <span class="radio-custom"></span>
                Sim
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="hasAllergy" value="nao">
                <span class="radio-custom"></span>
                N√£o
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['hasAllergy'].errors">
              <span *ngIf="f['hasAllergy'].errors['required']">Esta informa√ß√£o √© obrigat√≥ria</span>
            </div>
          </div>
        </div>

        <div class="form-row" *ngIf="f['hasAllergy'].value === 'sim'">
          <div class="form-group full-width">
            <label for="allergyDetails">Se sim, qual? *</label>
            <textarea 
              id="allergyDetails" 
              formControlName="allergyDetails"
              placeholder="Descreva suas alergias"
              rows="2"
              [class.error]="submitted && f['allergyDetails'].errors"
            ></textarea>
            <div class="error-message" *ngIf="submitted && f['allergyDetails'].errors">
              <span *ngIf="f['allergyDetails'].errors['required']">Detalhes da alergia s√£o obrigat√≥rios</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
            <label>Faz uso de alguma medica√ß√£o cont√≠nua ou importante?</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="usesMedication" value="sim">
                <span class="radio-custom"></span>
                Sim
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="usesMedication" value="nao">
                <span class="radio-custom"></span>
                N√£o
              </label>
            </div>
          </div>
        </div>

        <div class="form-row" *ngIf="f['usesMedication'].value === 'sim'">
          <div class="form-group full-width">
            <label for="medicationDetails">Se sim, qual?</label>
            <textarea 
              id="medicationDetails" 
              formControlName="medicationDetails"
              placeholder="Descreva as medica√ß√µes"
              rows="2"
              [class.error]="submitted && f['medicationDetails'].errors"
            ></textarea>
            <div class="error-message" *ngIf="submitted && f['medicationDetails'].errors">
              <span *ngIf="f['medicationDetails'].errors['required']">Detalhes da medica√ß√£o s√£o obrigat√≥rios</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Possui alguma restri√ß√£o alimentar?</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="dietaryRestriction" value="Nenhuma">
                <span class="radio-custom"></span>
                Nenhuma
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="dietaryRestriction" value="Vegetariana">
                <span class="radio-custom"></span>
                Vegetariana
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="dietaryRestriction" value="Intoler√¢ncia √† lactose">
                <span class="radio-custom"></span>
                Intoler√¢ncia √† lactose
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="dietaryRestriction" value="Intoler√¢ncia ao gl√∫ten">
                <span class="radio-custom"></span>
                Intoler√¢ncia ao gl√∫ten
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="dietaryRestriction" value="Outras">
                <span class="radio-custom"></span>
                Outras ‚Äì quais?
              </label>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚úùÔ∏è Enfoque e Cuidado -->
      <section class="form-section">
        <h2>‚úùÔ∏è Enfoque e Cuidado</h2>
        
        <div class="form-row">
        <div class="form-group">
            <label>Voc√™ j√° fez o teste de dom ministerial elaborado pela Lagoinha Manaus Sede? *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" formControlName="hasMinistryTest" value="sim">
                <span class="radio-custom"></span>
                Sim
              </label>
              <label class="radio-option">
                <input type="radio" formControlName="hasMinistryTest" value="nao">
                <span class="radio-custom"></span>
                N√£o
              </label>
            </div>
            <div class="error-message" *ngIf="submitted && f['hasMinistryTest'].errors">
              <span *ngIf="f['hasMinistryTest'].errors['required']">Esta informa√ß√£o √© obrigat√≥ria</span>
            </div>
          </div>
        </div>

        <div class="form-row" *ngIf="f['hasMinistryTest'].value === 'sim'">
          <div class="form-group full-width">
            <label for="ministryTestResults">Se sim, quais foram os dois resultados? Colocando primeiro o resultado principal. *</label>
            <textarea 
              id="ministryTestResults" 
              formControlName="ministryTestResults"
              placeholder="Digite os dois resultados do teste de dom ministerial"
              rows="3"
              [class.error]="submitted && f['ministryTestResults'].errors"
            ></textarea>
            <div class="error-message" *ngIf="submitted && f['ministryTestResults'].errors">
              <span *ngIf="f['ministryTestResults'].errors['required']">Resultados do teste s√£o obrigat√≥rios</span>
            </div>
          </div>
        </div>

        <div class="form-row" *ngIf="f['hasMinistryTest'].value === 'nao'">
          <div class="form-group full-width">
            <label>Se ainda n√£o fez, acesse o link abaixo e fa√ßa o teste, e coloque aqui a resposta:</label>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSckyHmtZXW381Xi-bZ8y-dV2DpN-nbBzJyzQWyz-lb2LtD9Qg/viewform" target="_blank" class="test-link">
              üîó Link para o Teste de Dom Ministerial
            </a>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="prayerRequest">Gostaria de deixar algum pedido de ora√ß√£o para a equipe? *</label>
            <textarea 
              id="prayerRequest" 
              formControlName="prayerRequest"
              placeholder="Compartilhe seu pedido de ora√ß√£o"
              rows="3"
              [class.error]="submitted && f['prayerRequest'].errors"
            ></textarea>
            <div class="error-message" *ngIf="submitted && f['prayerRequest'].errors">
              <span *ngIf="f['prayerRequest'].errors['required']">Pedido de ora√ß√£o √© obrigat√≥rio</span>
            </div>
          </div>
        </div>
      </section>

      <!-- üì∏ Termos e Autoriza√ß√£o -->
      <section class="form-section">
        <h2>üì∏ Termos e Autoriza√ß√£o</h2>
        
        <div class="form-row">
          <div class="form-group full-width">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" formControlName="imageAuthorization">
                <span class="checkbox-custom"></span>
                Autorizo o uso da minha imagem para registros, divulga√ß√£o e materiais do Minist√©rio Legacy da Igreja Batista da Lagoinha Manaus Sede. *
              </label>
              <div class="error-message" *ngIf="submitted && f['imageAuthorization'].errors">
                <span *ngIf="f['imageAuthorization'].errors['required']">Esta autoriza√ß√£o √© obrigat√≥ria</span>
              </div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" formControlName="analysisAwareness">
                <span class="checkbox-custom"></span>
                Estou ciente de que minha inscri√ß√£o passar√° por an√°lise e ser√° confirmada posteriormente. *
              </label>
              <div class="error-message" *ngIf="submitted && f['analysisAwareness'].errors">
                <span *ngIf="f['analysisAwareness'].errors['required']">Esta confirma√ß√£o √© obrigat√≥ria</span>
              </div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" formControlName="termsAwareness">
                <span class="checkbox-custom"></span>
                Estou ciente dos termos contratuais anexo que dever√° ser lido integralmente e enviada a c√≥pia assinada digitalmente (gov.br) para o contato da organiza√ß√£o. *
              </label>
              <div class="error-message" *ngIf="submitted && f['termsAwareness'].errors">
                <span *ngIf="f['termsAwareness'].errors['required']">Esta confirma√ß√£o √© obrigat√≥ria</span>
              </div>
            </div>
        </div>
      </div>

        <div class="form-row">
          <div class="form-group full-width">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" formControlName="truthDeclaration">
                <span class="checkbox-custom"></span>
                Declaro que todas as informa√ß√µes s√£o verdadeiras e me comprometo a seguir as regras do Legacy Camp. *
              </label>
              <div class="error-message" *ngIf="submitted && f['truthDeclaration'].errors">
                <span *ngIf="f['truthDeclaration'].errors['required']">Esta declara√ß√£o √© obrigat√≥ria</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- üß≠ Encerramento -->
      <section class="form-section">
        <h2>üß≠ Encerramento</h2>
        <div class="info-box">
          <p><strong>üìç Lembrando:</strong> O Legacy Camp √© um acampamento com vagas limitadas.</p>
          <p>Sua inscri√ß√£o ser√° avaliada e confirmada por nossa equipe nos dias seguintes. Fique atento ao seu e-mail, WhatsApp e redes sociais.</p>
        </div>
      </section>

      <div class="form-actions">
        <button 
          type="submit" 
          class="submit-button"
          [disabled]="isSubmitting"
        >
          <span *ngIf="!isSubmitting">Enviar Inscri√ß√£o</span>
          <span *ngIf="isSubmitting" class="loading">
            <span class="spinner"></span>
            Enviando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>



<!-- Modal de Confirma√ß√£o -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ modalTitle }}</h3>
      <button class="modal-close" (click)="closeModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="modal-icon" [class]="modalType">
        <span *ngIf="modalType === 'success'">‚úì</span>
        <span *ngIf="modalType === 'error'">‚úï</span>
      </div>
      <p>{{ modalMessage }}</p>
    </div>
    <div class="modal-footer">
      <button class="modal-button" (click)="closeModal()">
        {{ modalButtonText }}
      </button>
    </div>
  </div>
</div> 