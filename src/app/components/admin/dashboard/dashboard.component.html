<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <h1>Painel Administrativo</h1>
      <div class="header-actions">
        <span class="welcome-text">Bem-vindo, Administrador!</span>
        <button class="logout-button" (click)="logout()">Sair</button>
      </div>
    </div>
  </header>

  <main class="admin-main">
    <div class="dashboard-stats">
      <div class="stat-card">
        <h3>Total de Inscri√ß√µes</h3>
        <p class="stat-number">{{ inscricoes.length }}</p>
      </div>
      <div class="stat-card">
        <h3>Pendentes</h3>
        <p class="stat-number">{{ getInscricoesPorStatus("PENDENTE") }}</p>
      </div>
      <!-- <div class="stat-card">
        <h3>Parcial 01</h3>
        <p class="stat-number">{{ getInscricoesPorStatus('PARCIAL_01') }}</p>
      </div>
      <div class="stat-card">
        <h3>Parcial 02</h3>
        <p class="stat-number">{{ getInscricoesPorStatus('PARCIAL_02') }}</p>
      </div>
      <div class="stat-card">
        <h3>Parcial 03</h3>
        <p class="stat-number">{{ getInscricoesPorStatus('PARCIAL_02') }}</p>
      </div>
      <div class="stat-card">
        <h3>Parcial 04</h3>
        <p class="stat-number">{{ getInscricoesPorStatus('PARCIAL_02') }}</p>
      </div> -->
      <div class="stat-card">
        <h3>Aprovadas</h3>
        <p class="stat-number">{{ getInscricoesPorStatus("APROVADO") }}</p>
      </div>
      <div class="stat-card">
        <h3>Rejeitadas</h3>
        <p class="stat-number">{{ getInscricoesPorStatus("REJEITADO") }}</p>
      </div>
    </div>

    <div class="dashboard-stats secondary-stats">
      <div class="stat-card">
        <h3>1¬∫ Lote</h3>
        <p class="stat-number">{{ getInscricoesPorLote("lote1") }}</p>
      </div>
      <div class="stat-card">
        <h3>2¬∫ Lote</h3>
        <p class="stat-number">{{ getInscricoesPorLote("lote2") }}</p>
      </div>
      <!-- <div class="stat-card">
        <h3>Sem Cupom</h3>
        <p class="stat-number">{{ getInscricoesPorCupom('sem_cupom') }}</p>
      </div>
      <div class="stat-card">
        <h3>Com Cupom</h3>
        <p class="stat-number">{{ inscricoes.length - getInscricoesPorCupom('sem_cupom') }}</p>
      </div> -->
    </div>

    <div class="dashboard-stats coupon-stats">
      <div class="stat-card" *ngFor="let cupom of getCuponsUnicos()">
        <h3>Cupom {{ cupom }}</h3>
        <p class="stat-number">{{ getInscricoesPorCupom(cupom) }}</p>
      </div>
    </div>

    <!-- Cards de Valores -->
    <div class="dashboard-stats value-stats">
      <div class="stat-card value-card approved">
        <div class="value-card-header">
          <h3>üí∞ Valores Aprovados</h3>
          <button 
            class="toggle-value-btn"
            (click)="toggleShowApprovedValues()"
            [title]="showApprovedValues ? 'Ocultar valor' : 'Mostrar valor'"
          >
            {{ showApprovedValues ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        <p class="stat-number">
          {{ showApprovedValues ? formatarValor(getValorTotalAprovados()) : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' }}
        </p>
        <small>Valores j√° recebidos</small>
      </div>
      <div class="stat-card value-card pending">
        <div class="value-card-header">
          <h3>‚è≥ Valores Pendentes</h3>
          <button 
            class="toggle-value-btn"
            (click)="toggleShowPendingValues()"
            [title]="showPendingValues ? 'Ocultar valor' : 'Mostrar valor'"
          >
            {{ showPendingValues ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        <p class="stat-number">
          {{ showPendingValues ? formatarValor(getValorTotalPendentes()) : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' }}
        </p>
        <small>Valores a receber</small>
      </div>
      <div class="stat-card value-card total">
        <div class="value-card-header">
          <h3>üìä Valor Total</h3>
          <button 
            class="toggle-value-btn"
            (click)="toggleShowTotalValues()"
            [title]="showTotalValues ? 'Ocultar valor' : 'Mostrar valor'"
          >
            {{ showTotalValues ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        <p class="stat-number">
          {{ showTotalValues ? formatarValor(getValorTotalGeral()) : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' }}
        </p>
        <small>Total geral (sem rejeitados)</small>
      </div>
    </div>

    <div class="filters-section">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Buscar por nome, email ou telefone..."
          class="search-input"
        />
      </div>
      <div class="filter-group">
        <select [(ngModel)]="statusFilter" class="filter-select">
          <option value="">Todos os status</option>
          <option value="PENDENTE">Pendente</option>
          <option value="PARCIAL_01">R$ 50,00</option>
          <option value="PARCIAL_02">R$ 75,00</option>
          <option value="PARCIAL_03">R$ 100,00</option>
          <option value="PARCIAL_04">R$ 125,00</option>
          <option value="PARCIAL_05">R$ 150,00</option>
          <option value="PARCIAL_06">R$ 175,00</option>
          <option value="PARCIAL_07">R$ 200,00</option>
          <option value="PARCIAL_08">R$ 225,00</option>
          <option value="PARCIAL_09">R$ 250,00</option>
          <option value="PARCIAL_10">R$ 275,00</option>
          <option value="APROVADO">Aprovado</option>
          <option value="REJEITADO">Rejeitado</option>
        </select>
      </div>
      <div class="filter-group">
        <select [(ngModel)]="loteFilter" class="filter-select">
          <option value="">Todos os lotes</option>
          <option value="lote1">1¬∫ Lote - R$ 250,00</option>
          <option value="lote2">2¬∫ Lote - R$ 300,00</option>
        </select>
      </div>
      <div class="filter-group">
        <select [(ngModel)]="paymentMethodFilter" class="filter-select">
          <option value="">Todos os pagamentos</option>
          <option value="pix">PIX</option>
          <option value="cartao">Cart√£o</option>
          <option value="carne">Carn√™</option>
        </select>
      </div>
      <div class="filter-group">
        <select [(ngModel)]="couponFilter" class="filter-select">
          <option value="">Todos</option>
          <option value="sem_cupom">Sem Cupom</option>
          <option *ngFor="let cupom of getCuponsUnicos()" [value]="cupom">
            {{ cupom }}
          </option>
        </select>
      </div>
      <div class="filter-group">
        <select
          [(ngModel)]="itemsPerPage"
          (change)="alterarItensPorPagina(+$any($event.target).value)"
          class="filter-select"
        >
          <option value="5">5 por p√°gina</option>
          <option value="10">10 por p√°gina</option>
          <option value="20">20 por p√°gina</option>
          <option value="50">50 por p√°gina</option>
        </select>
      </div>
      <div class="filter-actions">
        <button class="clear-filters-button" (click)="limparFiltros()">
          üóëÔ∏è Limpar Filtros
        </button>
        <button
          class="refresh-button"
          (click)="carregarInscricoes()"
          [disabled]="isLoading"
        >
          {{ isLoading ? "Carregando..." : "Atualizar" }}
        </button>
        <button
          class="export-excel-button"
          (click)="exportarExcel()"
          [disabled]="isLoading"
        >
          üìä Exportar Excel
        </button>
      </div>
    </div>

    <div class="table-container">
      <div *ngIf="isLoading" class="loading">
        <p>Carregando inscri√ß√µes...</p>
      </div>

      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>

      <div *ngIf="!isLoading && !errorMessage" class="table-wrapper">
        <table class="inscricoes-table">
          <thead>
            <tr>
              <th class="checkbox-column">
                <input
                  type="checkbox"
                  [checked]="isSelectAllChecked"
                  (change)="toggleSelectAll()"
                  title="Selecionar todas"
                />
              </th>
              <th>Nome</th>
              <th>Pag.</th>
              <th>Email</th>
              <th>Telefone</th>
              <th>Lote</th>
              <th>Cupom</th>
              <th>Status</th>
              <!-- <th>Contrato</th> -->
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let inscricao of inscricoesFiltradas"
              class="table-row"
              style="color: #000"
            >
              <td class="checkbox-column">
                <input
                  type="checkbox"
                  [checked]="isInscricaoSelected(inscricao.id!)"
                  (change)="toggleSelectInscricao(inscricao.id!)"
                  title="Selecionar inscri√ß√£o"
                />
              </td>
              <td>
                <div class="inscricao-info">
                  <strong>{{ inscricao.fullName }}</strong>
                  <small>{{ inscricao.gender }}</small>
                </div>
              </td>
              <td>{{ formatarMetodoPagamento(inscricao.paymentMethod) }}</td>
              <td>{{ inscricao.email }}</td>
              <td>{{ inscricao.phone }}</td>
              <td>{{ inscricao.registrationLot }}</td>
              <td>
                <span
                  class="cupom-badge"
                  [ngClass]="getCupomBadgeClass(inscricao.couponCode)"
                >
                  {{ formatarCupom(inscricao.couponCode) }}
                </span>
              </td>
              <td>
                <span
                  class="status-badge"
                  [ngClass]="getStatusClass(inscricao.status)"
                >
                  {{ getStatusValue(inscricao.status || "PENDENTE") }}
                </span>
              </td>
              <!-- <td>
                <button 
                  class="details-button" 
                  (click)="enviarContrato(inscricao)"
                  title="Enviar contrato por email"
                >
                  ‚úâÔ∏è Contrato
                </button>
              </td> -->
              <td>
                <div class="actions">
                  <button
                    class="details-button"
                    (click)="abrirDetalhes(inscricao)"
                    title="Ver detalhes"
                  >
                    üëÅÔ∏è
                  </button>
                  <select
                    (change)="
                      atualizarStatus(inscricao, $any($event.target).value)
                    "
                    class="status-select-small"
                    [value]="inscricao.status || 'PENDENTE'"
                    [title]="
                      getStatusDescription(inscricao.status || 'PENDENTE')
                    "
                  >
                    <option
                      *ngFor="
                        let status of getStatusDisponiveis(
                          inscricao.paymentMethod
                        )
                      "
                      [value]="status"
                      [selected]="status === (inscricao.status || 'PENDENTE')"
                    >
                      {{ getStatusValue(status) }}
                    </option>
                  </select>

                  <!-- Dropdown de Emails -->
                  <div class="email-dropdown">
                    <button class="email-dropdown-toggle" title="Enviar emails">
                      üìß
                    </button>
                    <div class="email-dropdown-menu">
                      <button
                        class="email-dropdown-item"
                        (click)="enviarBemVindo(inscricao)"
                        title="Enviar email de bem-vindo"
                      >
                        üëã Envio de Bem-vindo
                      </button>
                      <button
                        class="email-dropdown-item"
                        (click)="enviarContrato(inscricao)"
                        title="Enviar contrato por email"
                      >
                        üìÑ Envio de Contrato
                      </button>

                      <button
                        class="email-dropdown-item"
                        (click)="enviarInstrucoesPagamento(inscricao)"
                        title="Enviar instru√ß√µes de pagamento"
                      >
                        üí≥ Envio de Instru√ß√£o de Pagamento
                      </button>
                      <button
                        class="email-dropdown-item custom-email-item"
                        (click)="abrirModalEmailPersonalizado(inscricao)"
                        title="Enviar email personalizado"
                      >
                        ‚úâÔ∏è Email Personalizado
                      </button>
                    </div>
                  </div>

                  <button
                    class="delete-button"
                    (click)="removerInscricao(inscricao)"
                    title="Remover inscri√ß√£o"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="inscricoesFiltradas.length === 0" class="no-results">
          <p>Nenhuma inscri√ß√£o encontrada.</p>
        </div>

        <!-- Bot√µes de envio em lote -->
        <div *ngIf="selectedCount > 0" class="bulk-actions">
          <div class="bulk-info">
            <span>{{ selectedCount }} inscri√ß√£o(√µes) selecionada(s)</span>
          </div>
          <div class="bulk-buttons">
            <button
              class="bulk-email-btn contract-btn"
              (click)="enviarContratoLote()"
              title="Enviar contrato para selecionados"
            >
              üìÑ Enviar Contrato
            </button>
            <button
              class="bulk-email-btn welcome-btn"
              (click)="enviarBemVindoLote()"
              title="Enviar bem-vindo para selecionados"
            >
              üëã Enviar Bem-vindo
            </button>
            <button
              class="bulk-email-btn payment-btn"
              (click)="enviarInstrucoesPagamentoLote()"
              title="Enviar instru√ß√µes de pagamento para selecionados"
            >
              üí≥ Enviar Instru√ß√µes
            </button>
            <button
              class="bulk-email-btn custom-btn"
              (click)="abrirModalEmailPersonalizadoLote()"
              title="Enviar email personalizado para selecionados"
            >
              ‚úâÔ∏è Email Personalizado
            </button>
          </div>
        </div>

        <!-- Informa√ß√µes de pagina√ß√£o -->
        <div *ngIf="totalInscricoesFiltradas > 0" class="pagination-info">
          <p>
            Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} a
            {{
              Math.min(currentPage * itemsPerPage, totalInscricoesFiltradas)
            }}
            de {{ totalInscricoesFiltradas }} inscri√ß√µes
          </p>
        </div>

        <!-- Controles de pagina√ß√£o -->
        <div *ngIf="totalPages > 1" class="pagination-controls">
          <button
            class="pagination-button"
            (click)="paginaAnterior()"
            [disabled]="currentPage === 1"
            title="P√°gina anterior"
          >
            ‚Üê Anterior
          </button>

          <div class="pagination-numbers">
            <button
              *ngFor="let pagina of paginasVisiveis"
              class="pagination-number"
              [class.active]="pagina === currentPage"
              (click)="irParaPagina(pagina)"
            >
              {{ pagina }}
            </button>
          </div>

          <button
            class="pagination-button"
            (click)="proximaPagina()"
            [disabled]="currentPage === totalPages"
            title="Pr√≥xima p√°gina"
          >
            Pr√≥xima ‚Üí
          </button>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal de Detalhes -->
<div
  *ngIf="showDetailsModal && selectedInscricao"
  class="modal-overlay"
  (click)="fecharDetalhes()"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalhes da Inscri√ß√£o</h2>
      <button class="close-button" (click)="fecharDetalhes()">√ó</button>
    </div>

    <div class="modal-body">
      <div class="details-grid">
        <!-- Informa√ß√µes Pessoais -->
        <div class="detail-section">
          <h3>Informa√ß√µes Pessoais</h3>
          <div class="detail-item">
            <strong>Nome Completo:</strong> {{ selectedInscricao.fullName }}
          </div>
          <div class="detail-item">
            <strong>Data de Nascimento:</strong>
            {{ formatarData(selectedInscricao.birthDate) }}
          </div>
          <div class="detail-item">
            <strong>Idade:</strong> {{ selectedInscricao.age }} anos
          </div>
          <div class="detail-item">
            <strong>G√™nero:</strong> {{ selectedInscricao.gender }}
          </div>
          <div class="detail-item">
            <strong>Telefone:</strong> {{ selectedInscricao.phone }}
          </div>
          <div class="detail-item">
            <strong>Email:</strong> {{ selectedInscricao.email }}
          </div>
          <div class="detail-item">
            <strong>Endere√ßo:</strong> {{ selectedInscricao.address }}
          </div>
          <div class="detail-item">
            <strong>Rede Social:</strong> {{ selectedInscricao.socialMedia }}
          </div>
        </div>

        <!-- Contato de Emerg√™ncia -->
        <div class="detail-section">
          <h3>Contato de Emerg√™ncia</h3>
          <div class="detail-item">
            <strong>Nome:</strong> {{ selectedInscricao.emergencyContactName }}
          </div>
          <div class="detail-item">
            <strong>Telefone:</strong>
            {{ selectedInscricao.emergencyContactPhone }}
          </div>
          <div class="detail-item">
            <strong>Relacionamento:</strong>
            {{ selectedInscricao.emergencyContactRelationship }}
          </div>
        </div>

        <!-- Informa√ß√µes Religiosas -->
        <div class="detail-section">
          <h3>Informa√ß√µes Religiosas</h3>
          <div class="detail-item">
            <strong>Membro da Lagoinha:</strong>
            {{ selectedInscricao.isLagoinhaMember }}
          </div>
          <div class="detail-item">
            <strong>Igreja:</strong> {{ selectedInscricao.churchName }}
          </div>
          <div class="detail-item">
            <strong>Participa√ß√£o em Minist√©rio:</strong>
            {{ selectedInscricao.ministryParticipation }}
          </div>
          <div class="detail-item">
            <strong>Teste de Minist√©rio:</strong>
            {{ selectedInscricao.hasMinistryTest }}
          </div>
          <div
            class="detail-item"
            *ngIf="selectedInscricao.ministryTestResults"
          >
            <strong>Resultados do Teste:</strong>
            {{ selectedInscricao.ministryTestResults }}
          </div>
        </div>

        <!-- Informa√ß√µes do Acampamento -->
        <div class="detail-section">
          <h3>Informa√ß√µes do Acampamento</h3>
          <div class="detail-item">
            <strong>Lote:</strong> {{ selectedInscricao.registrationLot }}
          </div>
            <div class="detail-item">
              <strong>M√©todo de Pagamento:</strong>
              {{ formatarMetodoPagamento(selectedInscricao.paymentMethod) }}
            </div>
          <div class="detail-item">
            <strong>Cupom Utilizado:</strong>
            <span
              class="cupom-badge"
              [ngClass]="getCupomBadgeClass(selectedInscricao.couponCode)"
            >
              {{ formatarCupom(selectedInscricao.couponCode) }}
            </span>
          </div>
          <div class="detail-item">
            <strong>Tamanho da Camiseta:</strong>
            {{ selectedInscricao.shirtSize }}
          </div>
        </div>

        <!-- Informa√ß√µes M√©dicas -->
        <div class="detail-section">
          <h3>Informa√ß√µes M√©dicas</h3>
          <div class="detail-item">
            <strong>Alergia:</strong> {{ selectedInscricao.hasAllergy }}
          </div>
          <div class="detail-item" *ngIf="selectedInscricao.allergyDetails">
            <strong>Detalhes da Alergia:</strong>
            {{ selectedInscricao.allergyDetails }}
          </div>
          <div class="detail-item" *ngIf="selectedInscricao.usesMedication">
            <strong>Usa Medica√ß√£o:</strong>
            {{ selectedInscricao.usesMedication }}
          </div>
          <div class="detail-item" *ngIf="selectedInscricao.medicationDetails">
            <strong>Detalhes da Medica√ß√£o:</strong>
            {{ selectedInscricao.medicationDetails }}
          </div>
          <div class="detail-item">
            <strong>Restri√ß√£o Alimentar:</strong>
            {{ selectedInscricao.dietaryRestriction }}
          </div>
        </div>

        <!-- Pedido de Ora√ß√£o -->
        <div class="detail-section">
          <h3>Pedido de Ora√ß√£o</h3>
          <div class="detail-item">
            <strong>Pedido:</strong> {{ selectedInscricao.prayerRequest }}
          </div>
        </div>

        <!-- Autoriza√ß√µes -->
        <div class="detail-section">
          <h3>Autoriza√ß√µes</h3>
          <div class="detail-item">
            <strong>Autoriza√ß√£o de Imagem:</strong>
            {{ formatarBoolean(selectedInscricao.imageAuthorization) }}
          </div>
          <div class="detail-item">
            <strong>Ci√™ncia da An√°lise:</strong>
            {{ formatarBoolean(selectedInscricao.analysisAwareness) }}
          </div>
          <div class="detail-item">
            <strong>Ci√™ncia dos Termos:</strong>
            {{ formatarBoolean(selectedInscricao.termsAwareness) }}
          </div>
          <div class="detail-item">
            <strong>Declara√ß√£o de Verdade:</strong>
            {{ formatarBoolean(selectedInscricao.truthDeclaration) }}
          </div>
        </div>

        <!-- Informa√ß√µes do Sistema -->
        <div class="detail-section">
          <h3>Informa√ß√µes do Sistema</h3>
          <div class="detail-item">
            <strong>Status:</strong>
            <span
              class="status-badge"
              [ngClass]="getStatusClass(selectedInscricao.status)"
            >
              {{ getStatusValue(selectedInscricao.status || "PENDENTE") }}
            </span>
          </div>
          <div class="detail-item">
            <strong>Data de Cria√ß√£o:</strong>
            {{ formatarDataCompleta(selectedInscricao.createdAt) }}
          </div>
          <div class="detail-item" *ngIf="selectedInscricao.updatedAt">
            <strong>√öltima Atualiza√ß√£o:</strong>
            {{ formatarDataCompleta(selectedInscricao.updatedAt) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Email Personalizado -->
<div
  *ngIf="showCustomEmailModal"
  class="modal-overlay"
  (click)="fecharModalEmailPersonalizado()"
>
  <div class="modal-content email-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Email Personalizado</h2>
      <button class="close-button" (click)="fecharModalEmailPersonalizado()">√ó</button>
    </div>
    
    <div class="modal-body">
      <div class="email-info">
        <h3 *ngIf="customEmailInscricao">Enviando para:</h3>
        <h3 *ngIf="!customEmailInscricao">Enviando em lote para:</h3>
        <p *ngIf="customEmailInscricao"><strong>Nome:</strong> {{ customEmailInscricao.fullName }}</p>
        <p *ngIf="customEmailInscricao"><strong>Email:</strong> {{ customEmailInscricao.email }}</p>
        <p *ngIf="!customEmailInscricao"><strong>{{ selectedCount }} inscri√ß√£o(√µes) selecionada(s)</strong></p>
      </div>
      
      <div class="email-form">
        <div class="form-group">
          <label for="emailSubject">Assunto:</label>
          <input
            type="text"
            id="emailSubject"
            [(ngModel)]="customEmailSubject"
            placeholder="Digite o assunto do email..."
            class="form-input"
            maxlength="200"
          />
        </div>
        
        <div class="form-group">
          <label for="emailMessage">Mensagem:</label>
          <textarea
            id="emailMessage"
            [(ngModel)]="customEmailMessage"
            placeholder="Digite a mensagem do email..."
            class="form-textarea"
            rows="4"
            maxlength="2000"
          ></textarea>
          <div class="char-count">{{ customEmailMessage.length }}/2000 caracteres</div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button
        class="cancel-button"
        (click)="fecharModalEmailPersonalizado()"
      >
        Cancelar
      </button>
      <button
        class="send-button"
        (click)="enviarEmailPersonalizado()"
        [disabled]="!customEmailSubject.trim() || !customEmailMessage.trim()"
      >
        üìß Enviar Email
      </button>
    </div>
  </div>
</div>
